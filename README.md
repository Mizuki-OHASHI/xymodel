# 2次元XY模型のパラレルテンパリングシミュレーション

このプログラムは、2次元正方格子上のXY模型を、**パラレルテンパリング法（レプリカ交換法）**を用いてシミュレーションし、各温度における**ヘリシティモジュラス**を計算するものです。

---

## 1. 物理モデルについて

### 2次元XY模型
2次元XY模型は、統計物理学における最も基本的なモデルの一つです。格子点上に配置されたスピンが、連続的な角度（0〜$2\pi$）を持つ2次元ベクトルとして振る舞います。

このモデルのハミルトニアン（エネルギー）は、最も近いスピン同士の相互作用によって以下のように定義されます。

$$ H = -J \sum_{\langle i,j \rangle} \cos(\theta_i - \theta_j) $$

ここで、$J$ は相互作用の強さ、$\theta_i$ はサイトiのスピンが持つ角度です。エネルギーは隣り合うスピンの向きが揃っているほど低くなります。

このモデルは、**コステリッツ・サウレス（KT）転移**として知られる、渦（Vortex）の生成と消滅に起因する特殊な相転移を示すことで有名です。

### ヘリシティモジュラス
ヘリシティモジュラス ($\Upsilon$) は、系全体をゆっくりとねじる（スピンの位相に勾配を与える）ことに対する「硬さ」や「剛性」を表す物理量です。

* **低温相（準長距離秩序相）**: スピン同士が強く相関しているため、系はねじれに対して「硬く」、ヘリシティモジュラスは有限の値を持ちます。
* **高温相（無秩序相）**: スピンがバラバラで相関が弱いため、系は「ふにゃふにゃ」でねじれに抵抗せず、ヘリシティモジュラスはゼロになります。

KT転移において、ヘリシティモジュラスは秩序変数のように振る舞い、転移温度 $T_{KT}$ で**有限の値からゼロへ不連続にジャンプする**という特徴的な性質を持ちます。この「普遍的な跳び」を観測することは、KT転移を同定する強力な手段となります。

---

## 2. シミュレーション手法について

### レプリカ交換法（パラレルテンパレリング）
モンテカルロ法のようなシミュレーションでは、低温領域でエネルギーの低い局所的な安定状態に「トラップ」され、シミュレーションが停滞してしまう問題（極低温でのスローイングダウン）があります。

**レプリカ交換法**はこの問題を解決するための強力な拡張アンサンブル法です。

1.  **複数のレプリカ**: 同じ系を、異なる温度で複数（$N_{REPLICAS}$個）同時に用意（複製）します。
2.  **並行シミュレーション**: 各レプリカは、それぞれが持つ温度に対応したモンテカルロステップ（メトロポリス法など）を並行して実行します。高温のレプリカはエネルギーの山を容易に乗り越え、広範な状態を探索できます。
3.  **状態の交換**: 一定間隔で、隣接する温度のレプリカ間でスピンの配位全体を交換することを試みます。

この「交換」により、低温で局所安定状態に陥ったスピン配位が高温のレプリカに移ることでトラップから脱出し、逆に高温で探索された多様な状態が低温のレプリカに供給されます。これにより、計算コストは増えますが、トラップ問題を回避し、はるかに効率的なサンプリングが可能になります。

---

## 3. プログラムの処理フロー

このプログラムは、以下の手順でシミュレーションを実行します。

1.  **初期化 (Initialization)**
    * コマンドライン引数から出力ファイル名を受け取ります。
    * シミュレーションパラメータ（格子サイズ、レプリカ数、温度範囲など）を設定します。
    * 各レプリカを初期化します。各レプリカは異なる逆温度 `beta` を持ち、スピンはランダムな角度で初期配置されます。
    * 各種パラメータと、物理量の測定結果を格納する配列を準備します。

2.  **初期緩和 (Thermalization)**
    * `THERMALIZATION_SWEEPS` で指定された回数だけシミュレーションループを回し、系を熱平衡状態に到達させます。この間のデータは測定には使用しません。

3.  **メインループと測定 (Main Loop & Measurement)**
    * `N_SAMPLING` で指定された回数の測定が完了するまで、以下のループを繰り返します。
        * **メトロポリス更新**: 全てのレプリカに対して、独立に1スイープのメトロポリス更新を実行します。
        * **レプリカ交換**: 隣接する温度のレプリカ間で、状態の交換を試みます。
        * **サンプリング**: `SAMPLE_INTERVAL_SWEEPS` ごとに、全レプリカに対してヘリシティモジュラスを計算するための物理量（x, y方向のボンドエネルギーとスピンカレント）を測定し、積算していきます。

4.  **計算と出力 (Finalization & Output)**
    * シミュレーションループが終了したら、積算されたデータから各レプリカの物理量の平均値を計算し、最終的なヘリシティモジュラスを算出します。
    * シミュレーションの諸条件と、各レプリカの最終的な物理量（逆温度、エネルギー、ヘリシティモジュラス）を指定されたファイルに出力します。
    * 全体の実行時間を標準出力に表示して終了します。

(Generated by Gemini)
